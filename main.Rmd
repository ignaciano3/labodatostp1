---
title: "Trabajo Práctico 1"
author: "Ignacio Garcia Pizales, ..."
date: "18 de Octubre"
output: html_notebook
---
------------------------------------------------------------------------

### Imports de paquetes

```{r}
require(dplyr)
require(rvest)
require(xml2)
require(geosphere)
require(lubridate)
```

### Preprocesamiento

#### Archivos csv Vuelos
```{r}
viajes = read.csv("202109-informe-ministerio.csv", sep = ";", encoding = "UTF-8")

viajes <- viajes %>% 
              rename(Hora = `Hora.UTC`,
                     Clase = `Clase.de.Vuelo..todos.los.vuelos.`,
                     Clasificación = `Clasificación.Vuelo`,
                     Tipo = `Tipo.de.Movimiento`,
                     Destino = `Origen...Destino`,
                     Aerolinea = `Aerolinea.Nombre`,
                     Calidad = `Calidad.dato`)
viajes$Fecha_Hora = paste(viajes$Fecha, viajes$Hora)
viajes$Fecha_Hora = dmy_hm(viajes$Fecha_Hora)
viajes = viajes[,c(-1, -2)]
viajes$id = 1:nrow(viajes)

head(sample_n(viajes, 10))
```


##### Separo en aterrizajes y despegues

```{r}
aterrizajes <- viajes %>% filter(Tipo == "Aterrizaje" & Clase == "Regular" & Clasificación == "Dom")
despegues <- viajes %>% filter(Tipo == "Despegue" & Clase == "Regular" & Clasificación == "Dom")
aterrizajes <- subset(aterrizajes, select = -c(Clase, Clasificación, Tipo, Calidad))
despegues <- subset(despegues, select = -c(Clase, Clasificación, Tipo, Calidad))

viajes_organizado <- despegues %>% 
                      inner_join(aterrizajes, by =
                               c("Destino" = "Aeropuerto",
                                 "Aeropuerto" = "Destino",
                                 "Aeronave" = "Aeronave",
                                 "Aerolinea" = "Aerolinea",
                                 "Pasajeros" = "Pasajeros"
                                 ))
head(viajes_organizado, 50)
```

```{r}
viajes_organizado$Fecha_Hora_Despegue = paste(viajes_organizado$Fecha, viajes_organizado$Hora.x)
viajes_organizado$Fecha_Hora_Aterrizaje = paste(viajes_organizado$Fecha, viajes_organizado$Hora.y)
viajes_organizado$Fecha_Hora_Despegue = dmy_hm(viajes_organizado$Fecha_Hora_Despegue)
viajes_organizado$Fecha_Hora_Aterrizaje = dmy_hm(viajes_organizado$Fecha_Hora_Aterrizaje)
rm(c(aeropuertos, aterrizajes, viajes))

viajes_organizado$dia_semana = wday(viajes_organizado$Fecha_Hora_Despegue, label = TRUE, abbr = FALSE)
head(sample_n(viajes_organizado, 10))

```

#### Parte Wikipedia

```{r}
pag_wiki = read_html("https://en.wikipedia.org/wiki/List_of_airports_in_Argentina")
elem_tabla = html_element(pag_wiki, ".wikitable")

latitud = html_nodes(pag_wiki, css = '.latitude')
latitud = html_text(latitud)

longitud = html_nodes(pag_wiki, css = '.longitude')
longitud = html_text(longitud)

aeropuertos = html_table(elem_tabla)
aeropuertos = aeropuertos[c(-4,-6)] # Elimino IATA, Coordenadas
aeropuertos["latitud"] = latitud
aeropuertos["longitud"] = longitud

rm(list = c("pag_wiki", "elem_tabla", "latitud", "longitud")) #Esto es para que no queden variables sueltas
head(aeropuertos, 10)
```

1. Agreguen nuevas variables con la ciudad, provincia y coordenadas que corresponde a cada aeropuerto.  

2. Calculen la distancia recorrida por cada vuelo. La función distHaversine del paquete
geosphere puede resultarles útil.

3. Calculen la velocidad media de cada vuelo 

```{r}
aeropuertos = aeropuertos[,c(3,5,6,1,2,4)]
head(aeropuertos)
```

Cosas para investigar
- que aeronaves se usan mas
- que marcas de aeronaves se usan mas
- que aerolinea, hora se viaja mas
en si barplots para cada variable

vuelo mas lejano
